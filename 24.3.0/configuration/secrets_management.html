<!DOCTYPE html>



<html>

<head>
  <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Secret Management | GoCD User Documentation</title>

<meta name="description" content="GoCD secret management"/>
<meta name="keywords" content="[GoCD configuration, secrets management, secrets, manage secrets, secrets config]"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="canonical" href="https://docs.gocd.org/current/configuration/secrets_management.html"/>
<script src="../javascripts/vendor/jquery-3.6.4.min.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="../javascripts/vendor/lunr-2.3.9.min.js"></script>

<script type="text/javascript" src="../javascripts/search/search.js"></script>
<script type="text/javascript" src="../javascripts/navigation/navigation.js"></script>
<script src="../javascripts/_common-to-all-pages.js" type="text/javascript"></script>

<link href="../images/favicon.ico" rel="shortcut icon">

<link rel="stylesheet" href="../stylesheets/normalize.min.css"/>
<link rel="stylesheet" href="../stylesheets/website.css"/>

<link rel="stylesheet" href="../stylesheets/book.min.ac5a65903b18d3093416406608606b21fbe03e953e39276b6a84377495f3a79e.css"/>

  
</head>

<body data-rel-permalink="/configuration/secrets_management.html">
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="main-container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<a href="https://www.gocd.org"> <img src="../svg/product_ui_logo_go.svg" class="icon" /></a>


    



<script>
    (function() {
        var menu = document.querySelector('aside.book-menu nav')
        addEventListener('beforeunload', function(event) {
            localStorage.setItem('menu.scrollTop', menu.scrollTop)
        });
    })();
    function loadFunction(){
        var menu = document.querySelector('aside.book-menu nav')
        var top = parseInt(localStorage.getItem('menu.scrollTop'));
        $(menu).animate({
            scrollTop: top
        }, 10)
    }
    $(document).ready = loadFunction();
</script>


<style>
  nav ul a[href$="\2f configuration\2fsecrets_management.html"] {
  color: #004ed0;
  }
</style>

<div class="search-input-container">
  <input id="search" type="text" placeholder="Type to search">
</div>
<ul>
  <li class="level1">
    <a href="https://www.gocd.org/"><b>Go to GoCD.org</b></a>
  </li>
</ul>
<hr>
<ul>
  <li class="level1 has-children">
    <figure class="menu-arrow"><img src="../images/arrow.png"/>
    </figure>

    <a href="#"><b>Welcome</b></a>
    <ul>
      <li class="level2"><a href="../">Introduction</a></li>
      <li class="level2"><a href="../introduction/concepts_in_go.html">Concepts in GoCD</a></li>
      <li class="level2"><a href="../navigation/value_stream_map.html">Value Stream Map</a></li>
    </ul>
  </li>
  <li class="level1 has-children">
    <figure class="menu-arrow"><img src="../images/arrow.png"/>
    </figure>

    <a href="#"><b>Installation</b></a>
    <ul>
      <li class="level2"><a href="../installation/">Installing GoCD</a></li>
      <li class="level2"><a href="../installation/system_requirements.html">System requirements</a></li>
      <li class="level2"><a href="../installation/installing_go_server.html">Installing GoCD Server</a>
        <ul>
          <li class="level3"><a href="../installation/install/server/linux.html">Linux</a></li>
          <li class="level3"><a href="../installation/install/server/windows.html">Windows</a></li>
          <li class="level3"><a href="../installation/install/server/osx.html">MacOS</a></li>
          <li class="level3"><a href="../installation/install/server/zip.html">Generic Zip</a></li>
        </ul>
      </li>
      <li class="level2"><a href="../installation/installing_go_agent.html">Installing GoCD Agent</a>
        <ul>
          <li class="level3"><a href="../installation/install/agent/linux.html">Linux</a></li>
          <li class="level3"><a href="../installation/install/agent/windows.html">Windows</a></li>
          <li class="level3"><a href="../installation/install/agent/osx.html">MacOS</a></li>
          <li class="level3"><a href="../installation/install/agent/zip.html">Generic Zip</a></li>
        </ul>
      </li>
      <li class="level2"><a href="../installation/configuring_database.html">Configuring GoCD Database</a></li>
        <ul>
          <li class="level3"><a href="../installation/configuring_database/h2.html">H2</a></li>
          <li class="level3"><a href="../installation/configuring_database/postgres.html">PostgreSQL</a></li>
          <li class="level3"><a href="../installation/configuring_database/mysql.html">MySQL</a></li>
          <li class="level3"><a href="../installation/configuring_database/connection-properties.html">Database Connection Properties</a></li>
        </ul>
      </li>
      <li class="level2"><a href="../installation/upgrading_go.html">Upgrading GoCD</a></li>
      <ul>
        <li class="level3"><a href="../installation/upgrading_go/upgrade_to_gocd_20.5.0.html">Upgrading to GoCD 20.5.0 and higher</a></li>
      </ul>
      <li class="level2"><a href="../installation/configuring_server_details.html">Configuring Server Details</a></li>
      <li class="level2"><a href="../installation/configure-reverse-proxy.html">Configure a Reverse Proxy</a></li>
      <li class="level2"><a href="../installation/configure-agent-proxy.html">Configure an agent with proxy</a></li>
      <li class="level2"><a href="../installation/ssl_tls_config.html">Configuring SSL/TLS</a>
        <ul>
          <li class="level3"><a href="../installation/ssl_tls/end_to_end_transport_security.html">End to end transport security</a></li>
          <li class="level3"><a href="../installation/ssl_tls/configuring_hsts_header.html">Configuring HSTS Header</a></li>
        </ul>
      </li>
      <li class="level2"><a href="../installation/performance_tuning.html">Performance Tuning</a></li>
      <li class="level2"><a href="../installation/hardware_specifications.html">Hardware Specifications</a></li>
    </ul>
  </li>
  <li class="level1 has-children">
    <figure class="menu-arrow"><img src="../images/arrow.png"/>
    </figure>

    <a href="#"><b>Configuration</b></a>
    <ul>
      <li class="level2"><a href="../configuration/pipelines.html">Pipelines</a>
        <ul>
          <li class="level3"><a href="../configuration/quick_pipeline_setup.html">Add a New Pipeline</a></li>
          <li class="level3"><a href="../configuration/admin_add_material.html">Add Material to Existing Pipeline</a></li>
          <li class="level3"><a href="../configuration/admin_add_stage.html">Add Stage to Existing Pipeline</a></li>
          <li class="level3"><a href="../configuration/admin_add_job.html">Add Job to Existing Stage</a></li>
          <li class="level3"><a href="../configuration/admin_add_task.html">Add Task to Existing Job</a></li>
          <li class="level3"><a href="../configuration/pipeline_templates.html">Pipeline Templates</a></li>
          <li class="level3"><a href="../configuration/admin_use_parameters_in_configuration.html">Using parameters in Pipelines and Templates</a></li>
          <li class="level3"><a href="../configuration/pipeline_labeling.html">Pipeline Labeling</a></li>
          <li class="level3"><a href="../configuration/pipeline_scheduling.html">Pipeline Scheduling</a></li>
          <li class="level3"><a href="../configuration/dev_choose_when_stage_runs.html">Choose When a Stage Runs</a></li>
          <li class="level3"><a href="../configuration/admin_timer.html">Timer Trigger</a></li>
          <li class="level3"><a href="../configuration/admin_lock_pipelines.html">Lock a Pipeline</a></li>
          <li class="level3"><a href="../configuration/job_timeout.html">Job Timeout</a></li>
          <li class="level3"><a href="../configuration/deleting_pipelines.html">Deleting Pipelines</a></li>
          <li class="level3"><a href="../configuration/managing_dependencies.html">Managing Dependencies</a></li>
        </ul>
      </li>
      <li class="level2"><a href="../configuration/managing_a_build_cloud.html">Managing Agents</a>
        <ul>
          <li class="level3"><a href="../configuration/elastic_agents.html">Elastic Agents</a></li>
          <li class="level3"><a href="../configuration/clone_existing_agents.html">Clone/Copy Existing Agents</a></li>
        </ul>
      </li>
      <li class="level2"><a href="../configuration/managing_environments.html">Managing Environments</a></li>
      <li class="level2"><a href="../configuration/managing_users.html">Managing Users</a>
        <ul>
          <li class="level3"><a href="../configuration/dev_authentication.html">Authentication</a></li>
          <li class="level3"><a href="../configuration/access_tokens.html">Access Tokens</a></li>
          <li class="level3"><a href="../configuration/dev_authorization.html">Authorizing Users</a></li>
          <li class="level3"><a href="../configuration/delegating_group_administration.html">Delegating Group Administration</a></li>
          <li class="level3"><a href="../configuration/pipeline_group_admin_config.html">Pipeline Group Administration</a></li>
          <li class="level3"><a href="../configuration/policy_in_gocd.html">Policy in GoCD</a></li>
        </ul>
      </li>
      <li class="level2"><a href="../configuration/secrets_management.html">Secrets Management</a>
      </li>
      <li class="level2">Artifacts
        <ul>
          <li class="level3"><a href="../configuration/dev_upload_test_report.html">Publish Reports and Artifacts</a></li>
          <li class="level3"><a href="../configuration/managing_artifacts_and_reports.html">Managing Artifacts and Reports</a></li>
          <li class="level3"><a href="../configuration/delete_artifacts.html">Auto Delete Artifacts</a></li>
        </ul>
      </li>
      <li class="level2"><a href="../configuration/admin_mailhost_info.html">Email server configuration</a></li>
      <li class="level2"><a href="../configuration/dev_notifications.html">Notifications</a></li>
      <li class="level2"><a href="../configuration/configuration_reference.html">Reference</a></li>
    </ul>
  </li>
  <li class="level1 has-children">
    <figure class="menu-arrow"><img src="../images/arrow.png"/>
    </figure>

    <a href="#"><b>Advanced Usage</b></a>
    <ul>
      <li class="level2"><a href="../advanced_usage/pipelines_as_code.html">Pipelines as code</a></li>
      <li class="level2"><a href="../advanced_usage/agent_auto_register.html">Auto Register a Remote Agent</a></li>
      <li class="level2"><a href="../advanced_usage/admin_spawn_multiple_jobs.html">Spawn multiple instances of a Job</a></li>
      <li class="level2"><a href="../advanced_usage/admin_install_multiple_agents.html">Multiple Agents on One Machine</a></li>
      <li class="level2"><a href="../advanced_usage/dev_clean_up_when_cancel.html">Clean on Task Cancel</a></li>
      <li class="level2"><a href="../advanced_usage/dev_conditional_task_execution.html">Conditional Task Execution</a></li>
      <li class="level2"><a href="../advanced_usage/trigger_with_options.html">Trigger With Options</a></li>
      <li class="level2"><a href="../advanced_usage/fan_in.html">Fan In</a></li>
      <li class="level2"><a href="../advanced_usage/logging.html">Logging</a></li>
      <li class="level2"><a href="../advanced_usage/ui_testing.html">UI Testing</a></li>
      <li class="level2"><a href="../advanced_usage/compare_pipelines.html">Compare Builds</a></li>
      <li class="level2"><a href="../advanced_usage/stage_duration_chart.html">Graphs</a></li>
      <li class="level2"><a href="../advanced_usage/one_click_backup.html">Backup GoCD Server</a></li>
      <li class="level2"><a href="../advanced_usage/cron_backup.html">Timer Based GoCD Server Backup</a></li>
      <li class="level2"><a href="../advanced_usage/config_repo.html">Config Repository</a></li>
      <li class="level2"><a href="../advanced_usage/other_config_options.html">Other Config Options</a></li>
      <li class="level2"><a href="../advanced_usage/agent-health-check-api.html">Agent Health Check API</a></li>
      <li class="level2"><a href="../advanced_usage/maintenance_mode.html">Maintenance Mode</a></li>
      <li class="level2"><a href="../advanced_usage/pipeline_activity.html">Pipeline activity</a></li>
      <li class="level2"><a href="../integration/">Integrating GoCD With Other Tools</a></li>
    </ul>
  </li>
  <li class="level1 has-children">
    <figure class="menu-arrow"><img src="../images/arrow.png"/>
    </figure>

    <a href="#"><b>GoCD on Kubernetes</b></a>
    <ul>
      <li class="level2"><a href="../gocd_on_kubernetes/introduction.html">Introduction</a></li>
      <li class="level2"><a href="../gocd_on_kubernetes/setup_and_configuration.html">Setup and configuration</a></li>
      <li class="level2"><a href="../gocd_on_kubernetes/helm_install.html">Install the GoCD Helm chart</a></li>
      <li class="level2"><a href="../gocd_on_kubernetes/importing_a_sample_workflow.html">Importing a sample workflow</a></li>
      <li class="level2"><a href="../gocd_on_kubernetes/sample_pipelines_explained.html">An explanation of the sample pipelines</a></li>
      <li class="level2"><a href="../gocd_on_kubernetes/docker_workflows.html">Docker workflows</a></li>
    </ul>
  </li>
  <li class="level1 has-children">
    <figure class="menu-arrow"><img src="../images/arrow.png"/>
    </figure>

    <a href="#"><b>Plugins in GoCD</b></a>
    <ul>
      <li class="level2"><a href="../extension_points/">Available extension points</a></li>
      <li class="level2"><a href="../extension_points/plugin_user_guide.html">Plugin User Guide</a></li>
      <li class="level2"><a href="../extension_points/package_repository_extension.html">Package Repository Extension</a></li>
      <li class="level2"><a href="../extension_points/yum_repository_poller.html">Yum Repository Poller</a></li>
      <li class="level2"><a href="../extension_points/scm_extension.html">SCM Extension</a></li>
      <li class="level2"><a href="../extension_points/task_extension.html">Task Extension</a></li>
    </ul>
  </li>
  <li class="level1 has-children">
    <figure class="menu-arrow"><img src="../images/arrow.png"/>
    </figure>

    <a href="#"><b>FAQ/Troubleshooting</b></a>
    <ul>
      <li class="level2"><a href="../faq/fixing_common_issues.html">Fixing common issues</a></li>
      <li class="level2"><a href="../faq/artifact_integrity.html">Artifact integrity verification</a></li>
      <li class="level2"><a href="../faq/rm_what_is_deployed.html">Check What's Deployed</a></li>
      <li class="level2"><a href="../faq/concurrent_config_modifications.html">Concurrent Modifications to Config</a></li>
      <li class="level2"><a href="../faq/docker_container_ssh_keys.html">Configure SSH Keys for dockerized GoCD</a></li>
      <li class="level2"><a href="../faq/deploy_a_specific_build_to_an_environment.html">Deploy a Specific Build</a></li>
      <li class="level2"><a href="../faq/rm_deploy_to_environment.html">Deploy to an environment</a></li>
      <li class="level2"><a href="../faq/material_update_hung.html">GoCD unable to poll for changes</a></li>
      <li class="level2"><a href="../faq/stage_old_config.html">Historical Configuration</a></li>
      <li class="level2"><a href="../faq/job_rerun.html">How do I re-run jobs?</a></li>
      <li class="level2"><a href="../faq/ordering_of_pipelines.html">Ordering of Pipelines</a></li>
      <li class="level2"><a href="../faq/dependency_management.html">Run Tests against new Builds</a></li>
      <li class="level2"><a href="../faq/admin_out_of_disk_space.html">Running out of Disk Space</a></li>
      <li class="level2"><a href="../faq/dev_see_artifact_as_tab.html">See artifacts as sub-tabs</a></li>
      <li class="level2"><a href="../faq/tester_what_has_changed.html">See changes in new binary</a></li>
      <li class="level2"><a href="../faq/dev_use_current_revision_in_build.html">Using Environment variables</a></li>
      <li class="level2"><a href="../faq/dev_understand_why_build_broken.html">Why the Build is Broken?</a></li>
    </ul>
  </li>
</ul>




</nav>
    </aside>

    
    <div class="navigation-bar">
    <a href="#" class="navigation navigation-prev">
        <i class="fa fa-angle-left"></i> &lt; Previous Page
    </a>

    <a href="#" class="navigation navigation-next">
        <i class="fa fa-angle-right"></i> Next Page &gt;
    </a>
</div>

    <div class="book-page ">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="../svg/menu.svg" />
  </label>
  <strong>Secret Management</strong>
</header>

      
<div class="has-results">
    <h1 id="searchResultTitle" class="search-results-title hide"></h1>
    <ul id="results"></ul>
</div>
<div class="no-results hide">
    Your query search resulted in no results.
</div>

      
<article class="markdown"><h1 id="secrets-management">Secrets Management</h1>
<p>Managing secrets is hard, ideally secrets should be stored securely, secrets need to have tight access controls and should be rotated on a regular interval. There are Secret Managers in the market which specialize in solving some of these problems around handling secrets. Leveraging these solutions, GoCD provides plugin endpoints to lookup for secrets defined in an external Secrets Manager. This gives GoCD users the flexibilty to use a Secret Manager of their choice to store and manage secrets.</p>
<p>At no point the external secrets are stored in GoCD, these secrets are looked up only when required, e.g if a job is configured to use external secrets, these secrets are looked up just before the job is assigned to an agent and transmitted securely to the agent.</p>
<h2 id="how-to-use-external-secrets-in-gocd">How to use external secrets in GoCD</h2>
<h3 id="step-1---install-a-secrets-plugin">Step 1 - Install a Secrets Plugin</h3>
<p>To look up for secrets from an external Secrets Manager you would need to install a Secrets Plugin which supports a Secret Manager of your choice. A list of available Secrets Plugins can be found <a href="https://www.gocd.org/plugins/#secrets">here</a>.</p>
<p>GoCD comes bundled with a Secrets Plugin which encrypts and stores secrets on a file. For more information about the File based Secrets Plugin please refer to the <a href="https://github.com/gocd/gocd-file-based-secrets-plugin#readme">documentation</a>.</p>
<h3 id="step-2---configure-a-secret-manager">Step 2 - Configure a Secret Manager</h3>
<p>A Secret Manager should be configured to lookup for secrets. A Secret Manager can be configured using the Secret Configuration, this configuration is specific to a plugin and would differ based on the plugin used.</p>
<p>Steps to configure a Secrets Manager, the below example uses the bundled File based Secrets Plugin,</p>
<ol>
<li>
<p>Login into your GoCD server.</p>
</li>
<li>
<p>Go to <strong>Admin</strong> menu → <strong>Secret Management</strong>.</p>
<p><img src="../images/configuration/secret-management/1_navigate_to_secret_management.png" alt="&ldquo;Navigate to secret management&rdquo;"></p>
</li>
<li>
<p>Click on <code>Add</code> button.</p>
<p><img src="../images/configuration/secret-management/2_secret_management_spa.png" alt="&ldquo;Add Secret Button&rdquo;"></p>
</li>
<li>
<p>Enter a unique id for secret configuration. This id will be referred in GoCD configurations while using the secrets.</p>
</li>
<li>
<p>In the Plugin dropdown select the plugin which supports a Secret Manager of your choice. Once a plugin is selected an appropriate configuration is displayed below.</p>
</li>
<li>
<p>Provide the path to the secrets file on the GoCD server.</p>
<p>The <a href="https://github.com/gocd/gocd-file-based-secrets-plugin#readme">secrets file plugin&rsquo;s documentation</a> has information about how to generate a secret file and manage secrets.</p>
<p><img src="../images/configuration/secret-management/3_add_secret_modal.png" alt="&ldquo;Add Secret Modal&rdquo;"></p>
</li>
</ol>
<h3 id="step-3---restrict-usage-of-secrets-manager">Step 3 - Restrict usage of Secrets Manager</h3>
<p>There can be cases wherein Admins might want to restrict the usage of Secret Manager or the secrets defined within a Secrets Manager. E.g  restrict usage of production secrets to a specific pipeline or environment. GoCD allows Admins to control usage of a Secret Manager through <code>Allow</code> or <code>Deny</code> rules. Rules define strict access control for a Secrets Manager.</p>
<ul>
<li>Users can define two types of rules
<ul>
<li>
<p><code>Allow</code> - Explicitly allows usage of the Secret Manager to a GoCD entity.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;allow</span> <span style="color:#b44">type=</span><span style="color:#b44">&#34;pipeline_group&#34;</span> <span style="color:#b44">action=</span><span style="color:#b44">&#34;refer&#34;</span><span style="color:#008000;font-weight:bold">&gt;</span>my_first_pipeline<span style="color:#008000;font-weight:bold">&lt;/allow&gt;</span>
</span></span></code></pre></div></li>
<li>
<p><code>Deny</code>  - Explicitly denies usage of the Secret Manager to a GoCD entity.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;deny</span> <span style="color:#b44">type=</span><span style="color:#b44">&#34;environment&#34;</span> <span style="color:#b44">action=</span><span style="color:#b44">&#34;refer&#34;</span><span style="color:#008000;font-weight:bold">&gt;</span>resource_identifier<span style="color:#008000;font-weight:bold">&lt;/deny&gt;</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<p>The rules have the following attributes,</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>This attribute represents the type of GoCD config entity. Can be one of <code>environment</code>, <code>pipeline_group</code>, <code>pluggable_scm</code>, <code>package_repository</code> or <code>cluster_profile</code>. To represent any entity type use the wildcard <strong>(*)</strong>.</td>
</tr>
<tr>
<td>action</td>
<td>This attribute represents the allowed action on the Secret Configuration, currently the only allowed action is <code>refer</code>.</td>
</tr>
<tr>
<td>resource</td>
<td>The name of resource. E.g. name of the environment when <code>type</code> = <code>environment</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>By default if no rule is defined, none of the GoCD entities will have access to the Secret Manager. Hence the Secret Manager would be unusable.</p>
<p><img src="../images/configuration/secret-management/4_edit_rules.png" alt="&ldquo;Edit Rules"></p>
</li>
</ul>
<h3 id="step-4---define-secret-params">Step 4 - Define Secret Params</h3>
<p>Once a Secret Manager is configured, you will have to define a Secret Param to lookup for a secret from an external Secrets Manager.</p>
<p>The syntax of a Secret Param is: <code>{{SECRET:[secret_config_id][secret_key]}}</code> where,</p>
<ul>
<li><code>secret_config_id</code>: is the unique id provided while creating secret configuration.</li>
<li><code>secret_key</code>: is the key which refers to a secret value stored in your external Secrets Manager.</li>
</ul>
<p><strong>Add a Secret Param</strong></p>
<p>Currently, GoCD allows Secret Params to be added in the following places,</p>
<ul>
<li>
<p>Password field for an SCM Material</p>
<p><img src="../images/configuration/secret-management/6_usage_in_scm_material.png" alt="&ldquo;Scm material configuration&rdquo;"></p>
</li>
<li>
<p>Value field of an environment variable.</p>
<p><img src="../images/configuration/secret-management/5_usage_in_environments_variables.png" alt="&ldquo;Environment variables&rdquo;"></p>
</li>
<li>
<p>Any configuration field of a Pluggable SCM</p>
<p><img src="../images/configuration/secret-management/7_usage_in_pluggable_scm.png" alt="&ldquo;Plugin Configuration for Pluggable SCM&rdquo;"></p>
</li>
<li>
<p>Any configuration field of a Package Repository</p>
<p><img src="../images/configuration/secret-management/8_usage_in_package_repository.png" alt="&ldquo;Plugin Configuration for Package Repository&rdquo;"></p>
</li>
<li>
<p>Any configuration field of a Package</p>
<p><img src="../images/configuration/secret-management/9_usage_in_package.png" alt="&ldquo;Plugin Configuration for Package&rdquo;"></p>
</li>
<li>
<p>Any configuration field for Cluster Profile</p>
<p><img src="../images/configuration/secret-management/10_usage_in_cluster_profile.png" alt="&ldquo;Plugin Configuration for Cluster Profile&rdquo;"></p>
</li>
<li>
<p>Any configuration field for Elastic Agent Profile</p>
<p><img src="../images/configuration/secret-management/11_usage_in_elastic_agent_profile.png" alt="&ldquo;Plugin Configuration for Elastic Agent Profile&rdquo;"></p>
</li>
</ul>
<p>Secret Params defined anywhere else other than the above would be ignored and treated as a string.</p>
<p><strong>Secret Param resolution</strong></p>
<p>Secrets from an external Secrets Manager are never stored in GoCD, hence the Secret Params are resolved just before they are required.</p>
<ul>
<li>Secret Params defined as a password in a SCM Material are resolved just before a Material is picked up for an update.</li>
<li>Secret Params defined as an environment variable is resolved before assigning work to an agent.</li>
<li>Secret Params defined in Pluggable SCM, Package Repository and Package will be resolved during
<ul>
<li>A check connection</li>
<li>Save/Validation of the configuration</li>
<li>For Plugin and Package materials, the secret params are resolved before being picked up for an update</li>
</ul>
</li>
<li>Secret Params defined in Elastic Configuration will be resolved during
<ul>
<li>Save/Validation of the configuration</li>
<li>The secret params are resolved just before GoCD makes a request to the the elastic agent plugin. The secret params are only resolved for requests with custer profile and elastic agent profile in the message.</li>
</ul>
</li>
</ul>
<p>If a Secret Param resolution fails the corresponding task would fail as well. This can lead to a failed job or a failed material update.</p>
<h3 id="more-about-rules">More about Rules</h3>
<ul>
<li>
<p>A restrictive model is followed while accessing a Secrets Manager. In the absence of a rule, a Secret Manager is inaccessible by default.</p>
<blockquote>
<p>The secret config defined in the example cannot be referred by any entity in GoCD.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;secretConfig</span> <span style="color:#b44">id=</span><span style="color:#b44">&#39;teamA_secrets&#39;</span> <span style="color:#b44">pluginId=</span><span style="color:#b44">&#39;vault_based_plugin&#39;</span><span style="color:#008000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&lt;description&gt;</span>All secrets for env1<span style="color:#008000;font-weight:bold">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000;font-weight:bold">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>      ...
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&lt;rules/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;/secretConfig&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>Wildcards <strong>(*)</strong> in <strong>type</strong>:</p>
<p>Using a wildcard <strong>(*)</strong> for type implies a given rule applies to all entity types. In this case, the supported entities are <code>pipeline_group</code>, <code>environment</code>, <code>pluggable_scm</code>, <code>package_repository</code> and <code>cluster_profile</code>.</p>
<blockquote>
<p>In the given example, a Secret Configuration can be referred by any of the supported entity with the name <code>production</code>.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;rules&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&lt;allow</span> <span style="color:#b44">type=</span><span style="color:#b44">&#34;*&#34;</span> <span style="color:#b44">action=</span><span style="color:#b44">&#34;refer&#34;</span><span style="color:#008000;font-weight:bold">&gt;</span>production<span style="color:#008000;font-weight:bold">&lt;/allow&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;/rules&gt;</span>
</span></span></code></pre></div><p><strong>Note</strong>: <code>type</code> can have a wildcard(<code>*</code>) but it will not support pattern matching e.g. <code>pipe*</code>.</p>
</li>
<li>
<p>Wildcards <strong>(*)</strong> in <strong>action</strong>:</p>
<p>Using a wildcard <strong>(*)</strong> for action implies a given rule applies to any action on the Secret Config. Currently <code>refer</code> is the only supported action.</p>
<p><strong>Note</strong>: <code>action</code> can have a wildcard(<code>*</code>) but it will not support pattern matching e.g. <code>ref*</code>.</p>
</li>
<li>
<p>Wildcards <strong>(*)</strong> in <strong>resource</strong>:</p>
<p>Resource name supports the wildcard characters &lsquo;?&rsquo; and &lsquo;*&rsquo; to represent a single or multiple (zero or more) wildcard characters.</p>
<table>
<thead>
<tr>
<th>Wildcard Matcher</th>
<th>Resource names</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*_group</code></td>
<td>Matches <code>my_group</code> and <code>someother_group</code>, but not <code>testgroup</code> or <code>group1</code>.</td>
</tr>
<tr>
<td><code>Production_*</code></td>
<td>Matches <code>Production_Team_A</code> and <code>Production_Team_B</code> but not <code>Team_ABC_Production_D</code>.</td>
</tr>
<tr>
<td><code>*group*</code></td>
<td>Matches <code>group</code>, <code>my_group</code> and <code>group_A</code>, but not <code>groABCup</code>.</td>
</tr>
<tr>
<td><code>Team_?_group</code></td>
<td>Matches <code>Team_A_group</code>, <code>Team_B_group</code> but not <code>Team_ABC_group</code> or <code>Team__group</code>.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>When multiple rules are defined, rules will be applied from top to bottom.</p>
<blockquote>
<p>In the below example pipeline_group <code>my_group</code> cannot refer to the secret_config since the first rule denies access using the pattern <code>my_*</code></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;rules&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000;font-weight:bold">&lt;deny</span> <span style="color:#b44">action=</span><span style="color:#b44">&#34;refer&#34;</span> <span style="color:#b44">type=</span><span style="color:#b44">&#34;pipeline_group&#34;</span><span style="color:#008000;font-weight:bold">&gt;</span>my_*<span style="color:#008000;font-weight:bold">&lt;/deny&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000;font-weight:bold">&lt;allow</span> <span style="color:#b44">action=</span><span style="color:#b44">&#34;refer&#34;</span> <span style="color:#b44">type=</span><span style="color:#b44">&#34;pipeline_group&#34;</span><span style="color:#008000;font-weight:bold">&gt;</span>my_group<span style="color:#008000;font-weight:bold">&lt;/allow&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#008000;font-weight:bold">&lt;/rules&gt;</span>
</span></span></code></pre></div><blockquote>
<p>In the below example pipeline_group <code>my_group</code> can refer to the secret_config since the first rule allows access.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;rules&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000;font-weight:bold">&lt;allow</span> <span style="color:#b44">action=</span><span style="color:#b44">&#34;refer&#34;</span> <span style="color:#b44">type=</span><span style="color:#b44">&#34;pipeline_group&#34;</span><span style="color:#008000;font-weight:bold">&gt;</span>my_group<span style="color:#008000;font-weight:bold">&lt;/allow&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000;font-weight:bold">&lt;deny</span> <span style="color:#b44">action=</span><span style="color:#b44">&#34;refer&#34;</span> <span style="color:#b44">type=</span><span style="color:#b44">&#34;pipeline_group&#34;</span><span style="color:#008000;font-weight:bold">&gt;</span>*<span style="color:#008000;font-weight:bold">&lt;/deny&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">&lt;/rules&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>Rules are applied during secret lookup. If an entity does not have the required permission to access the Secret Manager, the lookup will fail. A failed lookup results in a failed job or a failed material update based on where the secret param is defined.</p>
</li>
</ul>
</article>

      
<div class="align-center book-git-footer justify-between">
  

  
  <div>
    <a href="#" class="navigation navigation-prev">
      <i class="fa fa-angle-left"></i> &lt; Previous Page
    </a>
  </div>
  

  
  <div>
    <a id="suggest-edits" href="https://github.com/gocd/docs.go.cd/edit/master/content/configuration/secrets_management.md" target="_blank" rel="noopener">
      <img src="../svg/code-fork.svg" /> Suggest edits to this page
    </a>
  </div>
  

  
  <div>
    <a href="#" class="navigation navigation-next">
      <i class="fa fa-angle-right"></i> Next Page &gt;
    </a>
  </div>
  

</div>


    </div>

    

  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#how-to-use-external-secrets-in-gocd">How to use external secrets in GoCD</a>
      <ul>
        <li><a href="#step-1---install-a-secrets-plugin">Step 1 - Install a Secrets Plugin</a></li>
        <li><a href="#step-2---configure-a-secret-manager">Step 2 - Configure a Secret Manager</a></li>
        <li><a href="#step-3---restrict-usage-of-secrets-manager">Step 3 - Restrict usage of Secrets Manager</a></li>
        <li><a href="#step-4---define-secret-params">Step 4 - Define Secret Params</a></li>
        <li><a href="#more-about-rules">More about Rules</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>



  </main>

  
</body>

</html>
